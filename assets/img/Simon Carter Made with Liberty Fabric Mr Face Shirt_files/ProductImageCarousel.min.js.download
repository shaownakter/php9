var EkmProductImageCarousel=function(){const t=25e3,e=12,i=.001,n=.1,a="idle",o="base",s="none",r="panning",h="zoom",c="idle";var l=function(t){var e=t.constructor||function(){},i={};if(t.extends){var n=t.extends,a=e;e=function(){n.apply(this,arguments),a.apply(this,arguments)};var o=function(){};o.prototype=n.prototype,i=new o}var s,r={};for(var h in t)if(t.hasOwnProperty(h)){if("constructor"===h)continue;if("extends"===h)continue;if("get__"===h.slice(0,5)){r[s=h.slice(5)]=r[s]||{},r[s].getter=t[h];continue}if("set__"===h.slice(0,5)){r[s=h.slice(5)]=r[s]||{},r[s].setter=t[h];continue}if("static__"===h.slice(0,8)){e[s=h.slice(8)]=t[h];continue}i[h]=t[h]}for(var h in r)if(r.hasOwnProperty(h)){var c={enumerable:!0,configurable:!0};r[h].getter&&(c.get=r[h].getter),r[h].setter&&(c.set=r[h].setter),Object.defineProperty(i,h,c)}return e.prototype=i,e};function d(t,e,i){var n,a,o,s=0,r=function(){s++,n=e||this,a=arguments,i&&(o=setTimeout(r.settle,i))};return r.settle=function(){clearTimeout(o),s>0&&t.apply(n,a),s=0},r}function u(t,e){return(t%e+e)%e}function m(t,e,i){return t<e?e:t>i?i:t}function _(t,e,i){e=e||{},i=i||[];var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var a in e)e.hasOwnProperty(a)&&n.setAttribute(a,e[a]);for(var o=0,s=i.length;o<s;o++)n.appendChild(i[o]);return n}function p(t,e){return e.map(function(e){return t.indexOf(e.originalElement)})}function g(t){return new Promise(e=>/\.avif/i.test(t)?e(!0):/\.gif/i.test(t)||/\.apng/i.test(t)||/\.webp/i.test(t)?void fetch(t,{method:"GET",mode:"cors",credentials:"omit"}).then(t=>t.blob()).then(t=>new Promise(e=>{var i=new FileReader;i.addEventListener("load",t=>{e(t.target.result)}),i.readAsArrayBuffer(t)})).then(t=>new Uint8Array(t)).then(t=>{var i=(new TextDecoder).decode(t);(function(t){var e=t.indexOf("IDAT"),i=t.indexOf("acTL");return-1!=e&&i<e})(i)&&e(!0),function(t){return-1!=t.indexOf("ANMF")}(i)&&e(!0),function(t){if("GIF"!==(new TextDecoder).decode(t.slice(0,3)))return!1;for(var e=0,i=5,n=t.length-3;i<n;i++){var a=0==t[i]&&33==t[i+1]&&249==t[i+2];if(a&&++e>1)return!0}return!1}(t)&&e(!0),e(!1)}):e(!1))}var f=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,40)},E=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelRequestAnimationFrame||function(t){clearTimeout(t)},v=new l({constructor:function(t,e,i,n){this._duration=t,this._startValue=e,this._endValue=i,this._callbacks=n,this._startTime=null,this._stopped=!1,this._requestId=null},start:function(){this._startTime=+new Date,this._stopped=!1,this._requestId=f(this._tick.bind(this))},stop:function(){this._stopped=!0,null!==this._requestId&&(E(this._requestId),this._requestId=null)},_tick:function(){if(!this._stopped){var t=this._duration,e=this._startTime,i=this._startValue,n=this._endValue,a=(+new Date-e)/t,o=(n-i)*(a=Math.min(1,a))+i;this._callbacks.tick&&this._callbacks.tick(o,a),1===a&&(this._stopped=!0),this._stopped?(this._requestId=null,this._callbacks.complete&&this._callbacks.complete(o,a)):this._requestId=f(this._tick.bind(this))}}}),A=new l({constructor:function(t,e){this._state=t,this._reducer=e,this._listeners=[],this._dispatching=!1,this._dispatchQueue=[]},getState:function(){return this._state},dispatch:function(t){if(this._dispatchQueue.push(t),!this._dispatching){var e;for(this._dispatching=!0;e=this._dispatchQueue.shift();){var i=this._state=this._reducer(e,this._state);this._listeners.forEach(function(t){t(i)})}this._dispatching=!1}},subscribe:function(t){this._listeners[this._listeners.length]=t},unsubscribe:function(t){this._listeners=this._listeners.filter(function(e){return e!==t})}});function T(t){return t.map(function(t){return B(t.id)}).filter(function(t,e,i){return i.indexOf(t)===e})}function w(t,e){e=!1!==e;var i=new Map,n=T(t);return t.forEach(function(t,a){var o=parseInt(e&&t.getAttribute("data-pic-thumb-id")||n.indexOf(B(t.id)),10);i.set(a,o)}),i}function b(t){var e=t.panSlide+t.panOffset;t.panSlide=u(Math.round(e),t.imageData.length),t.panOffset=u(e+.5,1)-.5}function y(t,l){var d,_;function g(t,e){return e.trackedElementX=t.x,e.trackedElementY=t.y,e.trackedElementWidth=t.width,e.trackedElementHeight=t.height,e}function T(t,e){return e.panInitialOffset=e.panOffset,e.panLastTickTime=0,e.panVelocitySamples=[],e.panVelocity=0,e}function y(t,i){var n=i.panOffset;if(i.panOffset=i.panInitialOffset+t.x/i.trackedElementWidth,i.interactionContext=r,null!==i.panAnimationFrameId&&(E(i.panAnimationFrameId),i.panAnimationFrameId=null),0!==i.panLastTickTime){var a=+new Date-i.panLastTickTime;0!==a&&function(t,i){var n=t.panVelocitySamples;n.unshift(i)>e&&(t.panVelocitySamples=n.slice(0,e));var a=t.panVelocitySamples.reduce(function(t,e){return t+e},0);t.panVelocity=a/t.panVelocitySamples.length}(i,(i.panOffset-n)/a)}return i.panLastTickTime=+new Date,i}function x(t,e){return b(e),e.panLastTickTime=+new Date,e.panVelocitySamples=[],e.interactionContext=o,e.panAnimationFrameId=f(function(){d.dispatch({type:"PAN_VELOCITY_SETTLE_UPDATE"})}),e}function I(t,e){return e.panOffset=t.x,e}function S(t,e){if(e.interactionContext!==o)return e;if(Math.abs(e.panVelocity)<i)return e.panLastTickTime=0,e.panAnimationFrameId=null,function(t,e){return b(e),e.panInitialOffset=0,e.interactionContext=s,new v(400,e.panOffset,0,{tick:function(t){d.dispatch({type:"PAN_SETTLE_UPDATE",x:t})},complete:function(){d.dispatch({type:"PAN_SETTLE_DONE"})}}).start(),e}(0,e);var a=+new Date,r=a-e.panLastTickTime;return e.panOffset+=e.panVelocity*r,e.panVelocity=e.panVelocity*(1-n),e.panLastTickTime=a,b(e),e.panAnimationFrameId=f(function(){d.dispatch({type:"PAN_VELOCITY_SETTLE_UPDATE"})}),e}function k(t,e){return e.interactionContext=o,e.elementSlideMap.set(0,e.panSlide),e}function P(t,e){if(!e.useZoom)return e;var i=e.imageData[e.panSlide],n=e.trackedElementWidth,a=e.trackedElementHeight;return n>i.full.width&&a>i.full.height?e:(e.zoomTigger=t.trigger,e.interactionContext=h,e.zoomSlide=e.panSlide,e.zoomFocusX=m(t.x/e.trackedElementWidth,0,1),e.zoomFocusY=m(t.y/e.trackedElementHeight,0,1),e.trackedElementWidth>i.full.width&&(e.zoomFocusX=.5),e.trackedElementHeight>i.full.height&&(e.zoomFocusY=.5),null!==e.zoomAlphaTween&&(e.zoomAlphaTween.stop(),e.zoomAlphaTween=null),e.zoomAlphaTween=new v(400,e.zoomAlpha,1,{tick:function(t){d.dispatch({type:"UPDATE_ZOOM_ALPHA",alpha:t})},complete:function(){d.dispatch({type:"UPDATE_ZOOM_ALPHA",alpha:1})}}),e.zoomAlphaTween.start(),e)}function O(t,e){e.zoomFocusX=m(t.x/e.trackedElementWidth,0,1),e.zoomFocusY=m(t.y/e.trackedElementHeight,0,1);var i=e.imageData[e.panSlide];return e.trackedElementWidth>i.full.width&&(e.zoomFocusX=.5),e.trackedElementHeight>i.full.height&&(e.zoomFocusY=.5),e}function C(t,e){return e.interactionContext=o,null!==e.zoomAlphaTween&&(e.zoomAlphaTween.stop(),e.zoomAlphaTween=null),e.zoomAlphaTween=new v(400,e.zoomAlpha,0,{tick:function(t){d.dispatch({type:"UPDATE_ZOOM_ALPHA",alpha:t})},complete:function(){d.dispatch({type:"UPDATE_ZOOM_ALPHA",alpha:0})}}),e.zoomAlphaTween.start(),e}function D(t,e){return e.zoomAlpha=t.alpha,e}function M(t,e){var i=e.elements[t.slide],n=e.imageData.map(function(t){return t.originalElement}).indexOf(i);if(-1===n)return e;var a,s,r,h=e.panSlide;if(e.panSlide=n,e.panLastTickTime=0,e.panVelocitySamples=[],e.panVelocity=0,null!==e.panAnimationFrameId&&(E(e.panAnimationFrameId),e.panAnimationFrameId=null),e.interactionContext=o,t.swapThumbs&&h!==n){e.elementSlideMap=Z(e.elementSlideMap);var c=e.elementSlideMap.get(0),l=(a=e.elementSlideMap,s=n,r=null,a.forEach(function(t,e){a.get(e)===s&&(r=e)}),r);e.elementSlideMap.set(0,n),0===function(t,e){var i=0;return t.forEach(function(t){t===e&&i++}),i}(e.elementSlideMap,c)&&e.elementSlideMap.set(l,c)}return e}function L(t,e){if(e.imageData[e.panSlide].isVideo)return ekmPlayProductVideo(e.imageData[e.panSlide].videoData),e;if(e.useLightbox){var i=e.imageData.map(function(t){return t.isVideo?ekm.$("<a />").attr({href:t.full.src,"data-video":JSON.stringify(t.videoData)})[0]:ekm.$("<a />").attr("href",t.full.src)[0]});ekm.$(i).lightBox({margin:30,top:15});i[e.panSlide].click()}else e.imageData[e.panSlide].originalElement.cloneNode().click();return e}function R(t,e){return e.interactionContext=s,Y(e.elements,function(t){d.dispatch({type:"IMAGE_DATA_UPDATED",data:t})}),e.isUpdateingImageData=!0,e}function z(t,e){return e.interactionContext=o,e.imageData=t.data,e.visibleElements=p(e.elements,e.imageData),e.panSlide=0,e.elementSlideMap=w(e.elements,!1),e.isUpdateingImageData=!1,e}function N(t,e){return e.badges=t.badges,e.badgeWrapperX=t.wrapperRect.x,e.badgeWrapperY=t.wrapperRect.y,e.badgeWrapperWidth=t.wrapperRect.width,e.badgeWrapperHeight=t.wrapperRect.height,e}function H(t,e){return e.interactionContext===s?e:(e.interactionContext=s,e.panSlide=u(e.panSlide+1,e.imageData.length),e.panOffset=e.panOffset-1,e.elementSlideMap.set(0,e.panSlide),null!==e.panAnimationFrameId&&(E(e.panAnimationFrameId),e.panAnimationFrameId=null),new v(400,e.panOffset,0,{tick:function(t){d.dispatch({type:"PAN_DIR_UPDATE",x:t})},complete:function(){d.dispatch({type:"PAN_DIR_DONE"})}}).start(),e)}function U(t,e){return e.interactionContext===s?e:(e.interactionContext=s,e.panSlide=u(e.panSlide-1,e.imageData.length),e.panOffset=e.panOffset+1,e.elementSlideMap.set(0,e.panSlide),null!==e.panAnimationFrameId&&(E(e.panAnimationFrameId),e.panAnimationFrameId=null),new v(400,e.panOffset,0,{tick:function(t){d.dispatch({type:"PAN_DIR_UPDATE",x:t})},complete:function(){d.dispatch({type:"PAN_DIR_DONE"})}}).start(),e)}function F(t,e){return e.panOffset=t.x,e}function W(t,e){return e.interactionContext=o,e}function X(t,e){e.panImageData=t.data,e.panImageUrl=t.url,e.panImageSrcs=t.imgSrcs,e.panImageWidth=t.frameWidth,e.panImageHeight=t.frameHeight,clearTimeout(_);var i=new Image;return i.onload=function(){_=setTimeout(function(){d.getState().panImageSrcs===t.imgSrcs&&d.getState().panImageWidth===t.frameWidth&&d.getState().panImageHeight===t.frameHeight&&(d.dispatch({type:"PAN_IMAGE_LOADED",url:t.url,imgSrcs:t.imgSrcs,frameWidth:t.frameWidth,frameHeight:t.frameHeight}),URL.revokeObjectURL(t.url))},1e3)},i.src=t.url,e}function G(t,e){return e.panImageLoaded=!0,e}function V(t,e){return e.panInitialOffset=0,e.panVelocitySamples=[],e.interactionContext=s,e.panVelocity=0,new v(200,e.panOffset,0,{tick:function(t){d.dispatch({type:"PAN_SETTLE_UPDATE",x:t})},complete:function(){d.dispatch({type:"PAN_SETTLE_DONE"})}}).start(),e}function B(t,e){return e.isIntersecting=t.isIntersecting,e.isIntersecting?e:q(t,e)}function q(t,e){e.elementSlideMap=Z(e.elementSlideMap);var i=function(t){var e=[];return t.forEach(function(t,i){e[e.length]=i}),e}(e.elementSlideMap);i=i.slice(0,e.imageData.length);var n=Math.max.apply(null,i),a=e.elementSlideMap.get(0);return i.forEach(function(t){0!==t&&(++a>n&&(a=0),e.elementSlideMap.set(t,a))}),e}function $(t,e){return e.animationMode=t.mode,e}!function(t,e){var i=t.elements;Y(i,function(n){e({elements:i,visibleElements:p(i,n),elementSlideMap:w(i),isIntersecting:!1,isUpdateingImageData:!1,useLightbox:t.lightbox,useZoom:t.zoom,useZoomGlass:t.zoomOptions.glass,useZoomHoverTrigger:!!t.zoomOptions.hoverTrigger,context:a,interactionContext:o,imageData:n,animationMode:c,panImageData:[],panImageUrl:"",panImageSrcs:"",panFrameWidth:0,panFrameHeight:0,panImageLoaded:!1,panSlide:0,panInitialOffset:0,panOffset:0,panVelocity:0,panVelocitySamples:[],panLastTickTime:0,panAnimationFrameId:null,zoomSlide:0,zoomAlpha:0,zoomFocusX:0,zoomFocusY:0,zoomAlphaTween:null,zoomOrigin:t.zoomOptions.position||"center",zoomOffsetX:t.zoomOptions.offsetX||0,zoomOffsetY:t.zoomOptions.offsetY||0,zoomTigger:null,trackedElementX:0,trackedElementY:0,trackedElementWidth:0,trackedElementHeight:0,badgeWrapperX:0,badgeWrapperY:0,badgeWrapperWidth:0,badgeWrapperHeight:0,badges:[]})})}(t,function(t){d=new A(t,function(t,e){var i={TRACKED_ELEMENT_CHANGE:g,INTERACTION_START:T,PAN_UPDATE:y,PAN_SETTLE:x,PAN_SETTLE_UPDATE:I,PAN_VELOCITY_SETTLE_UPDATE:S,PAN_SETTLE_DONE:k,ZOOM_START:P,ZOOM_UPDATE:O,ZOOM_STOP:C,UPDATE_ZOOM_ALPHA:D,GOTO_SLIDE:M,OPEN_IMAGE:L,UPDATE_IMAGE_DATA:R,IMAGE_DATA_UPDATED:z,BADGE_CHANGED:N,PAN_RIGHT:H,PAN_LEFT:U,PAN_DIR_UPDATE:F,PAN_DIR_DONE:W,PAN_IMAGE_DATA_UPDATED:X,PAN_IMAGE_LOADED:G,PAN_CANCEL:V,INTERSECTION_CHANGE:B,RESET_THUMBNAIL_ORDER:q,UPDATE_ANIMATION_MODE:$}[t.type];return i?i(t,e):e}),l(d)})}var x,I,S,k=new l({constructor:function(t,e){this._store=t,this._element=e;e.getBoundingClientRect();this._x=0,this._y=0,this._width=0,this._height=0,this._badgeX=0,this._badgeY=0,this._badgeWidth=0,this._badgeHeight=0,this._badgeImgLength=0,setInterval(this._check.bind(this),750),window.addEventListener("resize",this._check.bind(this)),this._mo=new MutationObserver(this._onMutation.bind(this)),this._mo.observe(e,{childList:!0,subtree:!0}),window.IntersectionObserver&&(this._io=new IntersectionObserver(this._onIntersection.bind(this),{threshold:[0,1]}),this._io.observe(e),this._isIntersecting=null)},_check:function(){var t=this._element.getBoundingClientRect(),e=t.left+window.pageXOffset,i=t.top+window.pageYOffset,n=t.right-t.left,a=t.bottom-t.top;this._x===e&&this._y===i&&this._width===n&&this._height===a||(this._x=e,this._y=i,this._width=n,this._height=a,this._store.dispatch({type:"TRACKED_ELEMENT_CHANGE",x:e,y:i,width:n,height:a}));var o=this._element.querySelector(".ekm-product-image-badge-wrapper");o&&this._checkBadges(o)},_checkBadges:function(t){var e=X(t.querySelectorAll("img")),i=t.getBoundingClientRect(),n={x:i.left+window.pageXOffset,y:i.top+window.pageYOffset,width:i.right-i.left,height:i.bottom-i.top};e=e.map(function(t){return{src:t.src,width:t.getAttribute("width"),height:t.getAttribute("height"),top:t.style.top,left:t.style.left,bottom:t.style.bottom,right:t.style.right}});this._badgeX===n.x&&this._badgeY===n.y&&this._badgeWidth===n.width&&this._badgeHeight===n.height&&this._badgeImgLength===e.length||(this._badgeX=n.x,this._badgeY=n.y,this._badgeWidth=n.width,this._badgeHeight=n.height,this._badgeImgLength=e.length,this._store.dispatch({type:"BADGE_CHANGED",wrapperRect:n,badges:e}))},_onMutation:function(t){var e="ekm-product-image-badge-wrapper";t.forEach(function(t){if(t.target.classList.contains(e))(t.addedNodes.length||t.removedNodes.length)&&this._checkBadges(t.target);else if(t.removedNodes.length){X(t.removedNodes).some(function(t){return t.classList.contains(e)})&&(this._badgeX=0,this._badgeY=0,this._badgeWidth=0,this._badgeHeight=0,this._badgeImgLength=0,this._store.dispatch({type:"BADGE_CHANGED",wrapperRect:{x:0,y:0,width:0,height:0},badges:[]}))}},this)},_onIntersection:function(t,e){t.forEach(function(t){this._store.getState().isIntersecting!==t.isIntersecting&&this._store.dispatch({type:"INTERSECTION_CHANGE",isIntersecting:t.isIntersecting})},this)}}),P=new l({constructor:function(t){for(var e in this._values={},this._listeners={},t)t.hasOwnProperty(e)&&this.subscribe(e,t[e])},subscribe:function(t,e){var i=this._listeners[t]=this._listeners[t]||[];i[i.length]=e},check:function(t){var e=this._listeners;for(var i in e)if(e.hasOwnProperty(i)&&this._values[i]!==t[i]){var n=this._values[i]=t[i];e[i].forEach(function(t){t(i,n)})}}}),O=new l({constructor:function(t){this._store=t,this._state=null,this._element=document.createElement("div"),this._element.classList.add("ekm-pic-panviewport"),this._primaryImageParent=V(),this._onImageDataChange=d(function(){this._updateBackground()},this),this._onResize=d(function(){this._updateBackground(),this._updatePan()},this),this._onPan=d(function(){this._updatePan()},this),this._onIsUpdateingImageDataChange=d(function(){this._state.isUpdateingImageData&&this._setTempPanImage()},this),this._onAnimationModeChange=d(function(){this._updateVisibility()},this),this._pcc=new P({imageData:this._onImageDataChange,trackedElementWidth:this._onResize,trackedElementHeight:this._onResize,panSlide:this._onPan,panOffset:this._onPan,isUpdateingImageData:this._onIsUpdateingImageDataChange,animationMode:this._onAnimationModeChange})},toElement:function(){return this._element},update:function(t){this._state=t,this._pcc.check(t),this._onImageDataChange.settle(),this._onResize.settle(),this._onPan.settle(),this._onIsUpdateingImageDataChange.settle(),this._onAnimationModeChange.settle()},_setTempPanImage:function(){this._primaryImageParent&&(this._primaryImageParent.style.opacity=1,this._element.style.visibility="hidden")},_removeTempPanImage:function(){var t=this._primaryImageParent;if(t&&!this._state.isUpdateingImageData){this._element.style.visibility="visible";var e=parseFloat(getComputedStyle(t).opacity);if(0!==e){var i=200*e;this._tween&&this._tween.stop(),this._tween=new v(i,e,0,{tick:function(e){t.style.opacity=e},complete:function(){t.style.opacity=0}}),this._tween.start()}}},_updateBackground:function(){if(this._state){var e=this._state.imageData,i=e.map(function(t){return t.full}),n={frameWidth:this._state.trackedElementWidth,frameHeight:this._state.trackedElementHeight,videos:this._state.imageData.map(function(t){return t.isVideo})};this._cancelMakePanImage&&this._cancelMakePanImage(),this._cancelMakePanImage=function e(i,n,a){var o=!1;var s=function(){o=!0};!function(e){var i=new Image;i.src="/ekmps/assets/images/edititem/play-circle.png",i.onload=function(){e({img:i,width:i.naturalWidth||i.width,height:i.naturalHeight||i.height})},i.onerror=function(){e(null)},setTimeout(function(){e(null)},t)}(function(t){if(!o){var r=window.devicePixelRatio||1;r=n.devicePixelRatio||2;var h=n.frameWidth||0,c=n.frameHeight||0;if(0!==h&&0!==c){c*=r;var l=(h*=r)*i.length,d=i.map(function(e,i){var a=(h-2)/e.width;e.height*a>c&&(a=c/e.height);var o=e.width*a,s=e.height*a,r=(h-o)/2,l=(c-s)/2,d=[],u=n.videos[i];if(u&&null!==t){var m=function(t,e){var i=e.width/t.width;t.height*i>e.height&&(i=e.height/t.height);var n=t.width*i,a=t.height*i;return{dw:n,dh:a}}({width:t.width,height:t.height},{width:o,height:s});m.img=t.img,d.push(m)}return{dw:o,dh:s,dx:r,dy:l,img:e.img,overlays:d}}),u=document.createElement("canvas");u.width=Math.floor(l),u.height=Math.floor(c);var m=u.getContext("webgl",{premultiplyAlpha:!1}),_=Math.floor(m.drawingBufferWidth);if(_<Math.floor(l)){try{m.getExtension("WEBGL_lose_context").loseContext()}catch(t){}u=m=null;var p=_/l*r;s=e(i,{...n,devicePixelRatio:p},a)}else{var g=m.createShader(m.VERTEX_SHADER),f=m.createShader(m.FRAGMENT_SHADER);m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),m.enable(m.BLEND),m.blendFunc(m.ONE,m.ONE_MINUS_SRC_ALPHA),m.shaderSource(g,"attribute vec2 a_position;uniform vec2 u_resolution;uniform mat3 u_matrix;varying vec2 v_texCoord;void main() {\tgl_Position = vec4(u_matrix * vec3(a_position, 1), 1);\tv_texCoord = a_position;}"),m.shaderSource(f,"precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {\tgl_FragColor = texture2D(u_image, v_texCoord);   gl_FragColor.rgb *= gl_FragColor.a;}"),m.compileShader(g),m.compileShader(f);var E=m.createProgram();m.attachShader(E,g),m.attachShader(E,f),m.linkProgram(E),m.useProgram(E);var v=m.getAttribLocation(E,"a_position"),A=m.getUniformLocation(E,"u_matrix"),T=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,T),m.bufferData(m.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),m.STATIC_DRAW),m.enableVertexAttribArray(v),m.vertexAttribPointer(v,2,m.FLOAT,!1,0,0);var w="";if(d.forEach(function(t,e){offset=h*e,G(m,t,offset,h,c,A),t.overlays.forEach(function(t){G(m,t,offset,h,c,A)}),w+=t.img.src}),"function"==typeof u.msToBlob){var b=u.msToBlob(),y=URL.createObjectURL(b);try{m.getExtension("WEBGL_lose_context").loseContext()}catch(t){}u=m=null,a({dataUrl:y,imgSrcs:w,frameWidth:n.frameWidth,frameHeight:n.frameHeight,data:d.map(function(t){return{x:t.dx,y:t.dy,width:t.dw,height:t.dh,pixelRatio:r}})})}else u.toBlob(function(t){try{m.getExtension("WEBGL_lose_context").loseContext()}catch(t){}if(u=m=null,!o){var e=URL.createObjectURL(t);a({dataUrl:e,imgSrcs:w,frameWidth:n.frameWidth,frameHeight:n.frameHeight,data:d.map(function(t){return{x:t.dx,y:t.dy,width:t.dw,height:t.dh,pixelRatio:r}})})}})}}}});return function(){s()}}(i,n,function(t){t.frameWidth===this._state.trackedElementWidth&&t.frameHeight===this._state.trackedElementHeight&&e===this._state.imageData&&(this._state.panImageSrcs!==t.imgSrcs||this._state.panImageWidth!==t.frameWidth||this._state.panImageHeight!==t.frameHeight?(this._element.style.backgroundImage="url("+t.dataUrl+")",this._element.style.backgroundSize=100*t.data.length+"% 100%",this._removeTempPanImage(),this._store.dispatch({type:"PAN_IMAGE_DATA_UPDATED",data:t.data,url:t.dataUrl,imgSrcs:t.imgSrcs,frameWidth:t.frameWidth,frameHeight:t.frameHeight})):this._removeTempPanImage())}.bind(this))}},_updatePan:function(){var t=this._state.trackedElementWidth,e=t*-this._state.panSlide-t*this._state.panOffset;this._element.style.backgroundPositionX=e+"px"},_updateVisibility:function(){var t=this._state.animationMode==c;this._element.style.opacity=t?1:0}}),C=new l({constructor:function(){this._state=null,this._element=document.createElement("div"),this._element.classList.add("ekm-pic-zoomglass"),this._offsetX=50,this._offsetY=50;var t="ekmpic"+ +new Date;this._focusElement=_("rect",{x:"0",y:"0",width:"100",height:"100",fill:"black",stroke:"white","stroke-width":"1"}),this._colourElement=_("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"rgba(255, 255, 255, 0.75)",mask:"url(#"+t+")"}),this._svgElement=_("svg",{width:"100%",height:"100%"},[_("mask",{id:t},[_("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"grey"}),this._focusElement]),this._colourElement]),this._element.appendChild(this._svgElement),this._onFocusChange=d(function(){this._updateFocus()},this),this._onResize=d(function(){this._updateSize(),this._updateFocusSize()},this),this._pcc=new P({zoomFocusX:this._onFocusChange,zoomFocusY:this._onFocusChange,trackedElementWidth:this._onResize,trackedElementHeight:this._onResize,panSlide:this._updateFocusSize.bind(this),zoomAlpha:this._updateAlpha.bind(this)})},toElement:function(){return this._element},update:function(t){this._state=t,this._pcc.check(t),this._onFocusChange.settle(),this._onResize.settle()},_updateFocus:function(){var t=this._state,e=t.trackedElementWidth*t.zoomFocusX-this._offsetX,i=t.trackedElementHeight*t.zoomFocusY-this._offsetY,n=t.panImageData[t.panSlide];e=m(e,(n=n||{x:0,y:0,width:t.trackedElementWidth,height:t.trackedElementHeight,pixelRatio:1}).x/n.pixelRatio,n.x/n.pixelRatio+n.width/n.pixelRatio-2*this._offsetX),i=m(i,n.y/n.pixelRatio,n.y/n.pixelRatio+n.height/n.pixelRatio-2*this._offsetY),this._focusElement.setAttribute("x",e),this._focusElement.setAttribute("y",i),this._colourElement.setAttribute("x",n.x/n.pixelRatio),this._colourElement.setAttribute("y",n.y/n.pixelRatio),this._colourElement.setAttribute("width",n.width/n.pixelRatio),this._colourElement.setAttribute("height",n.height/n.pixelRatio)},_updateSize:function(){this._svgElement.setAttribute("width",this._state.trackedElementWidth),this._svgElement.setAttribute("height",this._state.trackedElementHeight)},_updateFocusSize:function(){var t=this._state,e=t.panImageData[t.panSlide];e=e||{x:0,y:0,width:t.trackedElementWidth,height:t.trackedElementHeight,pixelRatio:1};var i=t.imageData[t.panSlide].full,n=e.width/e.pixelRatio/i.width,a=t.trackedElementWidth*n,o=t.trackedElementHeight*n;this._focusElement.setAttribute("width",a),this._focusElement.setAttribute("height",o),this._offsetX=a/2,this._offsetY=o/2},_updateAlpha:function(){this._element.style.opacity=this._state.zoomAlpha}}),D=new l({constructor:function(){},toElement:function(){return document.createDocumentFragment()},update:function(t){}}),M=new l({constructor:function(t){this._store=t,this._state=null,this._element=document.createElement("div"),this._element.classList.add("ekm-pic-animationviewport"),this._addAnimationTimeoutId=null,this._onChange=d(function(){this._updateAnimation()},this),this._pcc=new P({interactionContext:this._onChange,panSlide:this._onChange,imageData:this._onChange,panImageData:this._onChange})},toElement:function(){return this._element},update:function(t){this._state=t,this._pcc.check(t),this._onChange.settle()},_updateAnimation:function(){if(this._state.interactionContext===o){var t=this._state.imageData[this._state.panSlide];t.isAnimated?this._addAnimation(t.full.img):this._removeAnimation()}else this._removeAnimation()},_addAnimation:function(t){clearTimeout(this._addAnimationTimeoutId),this._addAnimationTimeoutId=setTimeout(()=>{var e=this._state.panImageData[this._state.panSlide];if(e){var{width:i,pixelRatio:n}=e,a=t.cloneNode();for(a.style.width=`${i/n}px`;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element.appendChild(a),this._store.dispatch({type:"UPDATE_ANIMATION_MODE",mode:"playing"})}},750)},_removeAnimation:function(){for(clearTimeout(this._addAnimationTimeoutId);this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._store.dispatch({type:"UPDATE_ANIMATION_MODE",mode:c})}}),L=new l({constructor:function(){this._state=null,this._element=document.createElement("div"),this._element.classList.add("ekm-pic-zoomviewport"),this._onSlideChange=d(function(){this._updateSilde()},this),this._onFocus=d(function(){this._updateFocusPosition(),this._updateFocusPosition()},this),this._onPositionChange=d(function(){this._updatePosition()},this),this._pcc=new P({imageData:this._onSlideChange,zoomSlide:this._onSlideChange,zoomAlpha:this._updateAlpha.bind(this),zoomFocusX:this._onFocus,zoomFocusY:this._onFocus,zoomOrigin:this._onPositionChange,zoomOffsetX:this._onPositionChange,zoomOffsetY:this._onPositionChange,trackedElementX:this._onPositionChange,trackedElementY:this._onPositionChange,trackedElementWidth:this._onPositionChange,trackedElementHeight:this._onPositionChange})},toElement:function(){return this._element},update:function(t){this._state=t,this._pcc.check(t),this._onSlideChange.settle(),this._onFocus.settle(),this._onPositionChange.settle()},_updateSilde:function(){var t=this._state,e=t.imageData[t.zoomSlide].full.src;this._element.style.backgroundImage="url("+CSS.escape(e)+")"},_updateAlpha:function(){this._element.style.opacity=this._state.zoomAlpha,this._element.style.display=0===this._state.zoomAlpha?"none":""},_updateFocusPosition:function(){var t=this._state;if("center"===t.zoomOrigin&&0===t.zoomOffsetX&&0===t.zoomOffsetY){var e=m(120*t.zoomFocusX-10,0,100),i=m(120*t.zoomFocusY-10,0,100);return this._element.style.backgroundPositionX=e+"%",void(this._element.style.backgroundPositionY=i+"%")}var n=t.imageData[t.panSlide].full.width,a=t.imageData[t.panSlide].full.height,o=(t.trackedElementWidth-2)/n;a*o>t.trackedElementHeight&&(o=t.trackedElementHeight/a);var s=(t.trackedElementWidth-n*o)/2,r=(t.trackedElementHeight-a*o)/2,h=t.trackedElementWidth/o,c=t.trackedElementHeight/o,l=h*t.zoomFocusX,d=c*t.zoomFocusY,u=l-t.trackedElementWidth/2,_=d-t.trackedElementHeight/2;_-=r/o,u=m(-(u-=s/o),-(n-t.trackedElementWidth),0),_=m(-_,-(a-t.trackedElementHeight),0),this._element.style.backgroundPositionX=u+"px",this._element.style.backgroundPositionY=_+"px"},_updatePosition:function(){var t=this._state,e=0,i=0;"left"===t.zoomOrigin&&(e=-t.trackedElementWidth),"right"===t.zoomOrigin&&(e=t.trackedElementWidth),e+=t.zoomOffsetX,i+=t.zoomOffsetY,this._element.style.left=e+"px",this._element.style.top=i+"px"}}),R=new l({constructor:function(t){this._store=t,t.subscribe(this._onUpdate.bind(this)),this._element=document.createElement("div"),this._element.classList.add("ekm-pic-eventmask"),t.getState().useZoom&&this._element.classList.add("ekm-pic-zoomable"),this._pcc=new P({interactionContext:this._onInteractionContextChange.bind(this)}),this._interactionContext=t.getState().interactionContext,this._expectingMouseUp=!1,this._expectingMouseMove=!1,this._expectingShortPress=!1,this._expectingTouchEnd=!1,this._expectingTouchMove=!1,this._originX=0,this._originY=0,this._originPageX=0,this._originPageY=0,this._longPressTimoutId=null,this._scrollY=window.pageYOffset,this._useZoomHoverTrigger=t.getState().useZoomHoverTrigger,this._waitForZoomHover=!1,this._zoomHoverTimeoutId=null,this._queueZoomHoverOnContextChange=!1,document.addEventListener("mousedown",this._onMouseDown.bind(this)),document.addEventListener("mouseup",this._onMouseUp.bind(this)),document.addEventListener("mousemove",this._onMouseMove.bind(this)),this._element.addEventListener("mouseenter",this._onMouseEnter.bind(this)),this._element.addEventListener("mouseleave",this._onMouseLeave.bind(this)),document.addEventListener("touchstart",this._onTouchStart.bind(this),{passive:!1}),document.addEventListener("touchend",this._onTouchEnd.bind(this),{passive:!1}),document.addEventListener("touchcancel",this._onTouchEnd.bind(this),{passive:!1}),document.addEventListener("touchmove",this._onTouchMove.bind(this),{passive:!1}),window.addEventListener("scroll",this._onScroll.bind(this))},toElement:function(){return this._element},_onUpdate:function(t){this._interactionContext=t.interactionContext,this._pcc.check(t)},_onMouseDown:function(t){t.target===this._element&&(this._expectingMouseUp||(t.preventDefault(),clearTimeout(this._zoomHoverTimeoutId),this._waitForZoomHover=!1,this._expectingMouseUp=!0,this._expectingMouseMove=!0,this._expectingShortPress=!0,this._originX=t.screenX,this._originY=t.screenY,this._originPageX=t.pageX,this._originPageY=t.pageY,this._store.dispatch({type:"INTERACTION_START"}),this._longPressTimoutId=setTimeout(this._onLongPress.bind(this),750)))},_onMouseUp:function(t){this._expectingMouseUp&&(t.preventDefault(),clearTimeout(this._longPressTimoutId),this._expectingMouseUp=!1,this._expectingMouseMove=!1,this._interactionContext===r&&this._store.dispatch({type:"PAN_SETTLE"}),this._interactionContext===h&&this._store.dispatch({type:"ZOOM_STOP"}),this._expectingShortPress&&this._interactionContext===o&&0===t.button&&this._store.dispatch({type:"OPEN_IMAGE"}))},_onMouseMove:function(t){if(this._waitForZoomHover&&(this._originX=t.screenX,this._originY=t.screenY,this._originPageX=t.pageX,this._originPageY=t.pageY),this._expectingMouseMove){t.preventDefault(),this._expectingShortPress=!1;var e=this._interactionContext,i=r,n=o,a=Math.abs(t.screenX-this._originX);if(a>50&&clearTimeout(this._longPressTimoutId),e===i||e===n&&a>50)this._store.dispatch({type:"PAN_UPDATE",x:-(t.screenX-this._originX)});else if(e===h){var s=this._store.getState();this._store.dispatch({type:"ZOOM_UPDATE",x:t.pageX-s.trackedElementX,y:t.pageY-s.trackedElementY})}}},_onMouseEnter:function(){if(this._isMouseOverElement=!0,this._useZoomHoverTrigger){var t=this._interactionContext;t!==s&&t!==r||(this._queueZoomHoverOnContextChange=!0),t===o&&(this._waitForZoomHover=!0,this._zoomHoverTimeoutId=setTimeout(this._onZoomHover.bind(this),750))}},_onMouseLeave:function(){this._isMouseOverElement=!1,this._useZoomHoverTrigger&&(this._waitForZoomHover&&(this._waitForZoomHover=!1,clearTimeout(this._zoomHoverTimeoutId)),this._queueZoomHoverOnContextChange=!1,this._interactionContext===h&&"hover"===this._store.getState().zoomTigger&&(this._expectingMouseUp=!1,this._expectingMouseMove=!1,this._store.dispatch({type:"ZOOM_STOP"})))},_onTouchStart:function(t){if(t.target===this._element&&!(t.touches.length>1)){this._expectingTouchEnd=!0,this._expectingTouchMove=!0,this._expectingShortPress=!0;var e=t.touches[0],i=Math.max(e.radiusX||0,e.radiusy||0);this._originX=e.screenX,this._originY=e.screenY-i,this._originPageX=e.pageX,this._originPageY=e.pageY-i,this._store.dispatch({type:"INTERACTION_START"}),this._longPressTimoutId=setTimeout(this._onLongPress.bind(this),750)}},_onTouchEnd:function(t){this._expectingTouchEnd&&(clearTimeout(this._longPressTimoutId),this._expectingTouchEnd=!1,this._expectingTouchMove=!1,this._interactionContext===r&&this._store.dispatch({type:"PAN_SETTLE"}),this._interactionContext===h&&this._store.dispatch({type:"ZOOM_STOP"}),this._expectingShortPress&&this._interactionContext===o&&(t.preventDefault(),this._store.dispatch({type:"OPEN_IMAGE"})))},_onTouchMove:function(t){if(this._expectingTouchMove&&!(t.touches.length>1)){this._expectingShortPress=!1;var e=t.touches[0],i=Math.max(e.radiusX||0,e.radiusy||0),n=e.screenX,a=(e.screenY,e.pageX),s=e.pageY-i,c=this._interactionContext,l=r,d=o,u=Math.abs(n-this._originX);if(u>50&&clearTimeout(this._longPressTimoutId),c===l||c===d&&u>50)return t.preventDefault(),void this._store.dispatch({type:"PAN_UPDATE",x:-(n-this._originX)});if(c===h){t.preventDefault();var m=this._store.getState();this._store.dispatch({type:"ZOOM_UPDATE",x:a-m.trackedElementX,y:s-m.trackedElementY})}}},_onScroll:function(){this._expectingTouchMove?Math.abs(this._scrollY-window.pageYOffset)>25&&(clearTimeout(this._longPressTimoutId),this._interactionContext!==h&&(this._expectingTouchMove=!1),this._interactionContext===r&&this._store.dispatch({type:"PAN_CANCEL"})):this._scrollY=window.pageYOffset},_onLongPress:function(){var t=this._store.getState();this._expectingShortPress=!1,this._store.dispatch({type:"ZOOM_START",x:this._originPageX-t.trackedElementX,y:this._originPageY-t.trackedElementY,trigger:"long_press"})},_onInteractionContextChange:function(){var t=this._interactionContext,e=this._element;e.classList.remove("ekm-pic-panning"),e.classList.remove("ekm-pic-zooming"),t===r&&e.classList.add("ekm-pic-panning"),t===h&&(e.classList.add("ekm-pic-zooming"),this._expectingMouseMove=!0),this._useZoomHoverTrigger&&(this._queueZoomHoverOnContextChange&&t===o?(this._queueZoomHoverOnContextChange=!1,this._waitForZoomHover=!0,this._zoomHoverTimeoutId=setTimeout(this._onZoomHover.bind(this),750)):(t===s&&this._isMouseOverElement&&(this._queueZoomHoverOnContextChange=!0),clearTimeout(this._zoomHoverTimeoutId),this._waitForZoomHover=!1))},_onZoomHover:function(){if(this._waitForZoomHover){var t=this._store.getState();this._waitForZoomHover=!1,this._expectingShortPress=!1,this._store.dispatch({type:"ZOOM_START",x:this._originPageX-t.trackedElementX,y:this._originPageY-t.trackedElementY,trigger:"hover"})}}}),z=new l({constructor:function(){this._state=null,this._element=document.createElement("div"),this._element.classList.add("ekm-pic-badges"),this._onUpdateWrapper=d(function(){this._updateWrapper()},this),this._pcc=new P({zoomAlpha:this._updateAlpha.bind(this),badges:this._updateBadges.bind(this),badgeWrapperX:this._onUpdateWrapper,trackedElementX:this._onUpdateWrapper,badgeWrapperY:this._onUpdateWrapper,trackedElementY:this._onUpdateWrapper,badgeWrapperWidth:this._onUpdateWrapper,badgeWrapperHeight:this._onUpdateWrapper})},toElement:function(){return this._element},update:function(t){this._state=t,this._pcc.check(t),this._onUpdateWrapper.settle()},_updateAlpha:function(){this._element.style.opacity=1-this._state.zoomAlpha},_updateWrapper:function(){var t=this._element.querySelector(".ekm-product-image-badge-wrapper");if(t){var e=this._state;t.style.position="absolute",t.style.left=e.badgeWrapperX-e.trackedElementX+"px",t.style.top=e.badgeWrapperY-e.trackedElementY+"px",t.style.width=e.badgeWrapperWidth+"px",t.style.height=e.badgeWrapperHeight+"px"}},_updateBadges:function(){for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);if(0!==this._state.badges.length){var t=this._state,e=document.createElement("span");e.classList.add("ekm-product-image-badge-wrapper"),t.badges.forEach(function(t){var i=document.createElement("img");i.src=t.src,t.width&&(i.setAttribute("width",t.width),i.style.width=`${t.width}px`),t.height&&(i.setAttribute("height",t.height),i.style.height=`${t.height}px`),null===t.top&&void 0===t.top||(i.style.top=t.top),null===t.left&&void 0===t.left||(i.style.left=t.left),null===t.bottom&&void 0===t.bottom||(i.style.bottom=t.bottom),null===t.right&&void 0===t.right||(i.style.right=t.right),e.appendChild(i)}),this._element.appendChild(e),this._updateWrapper()}}}),N=new l({constructor:function(t){this._store=t;var e=t.getState();t.subscribe(this._onUpdate.bind(this)),this._panViewport=new O(t),this._zoomGlass=e.useZoomGlass?new C:new D,this._productBadges=new z,this._animationViewPort=new M(t),this._zoomViewport=new L,this._eventMask=new R(t),this._element=document.createElement("div"),this._element.classList.add("ekm-pic-root"),this._element.style.width="532.41px",this._element.style.height="532.41px",this._element.appendChild(this._panViewport.toElement()),this._element.appendChild(this._zoomGlass.toElement()),this._element.appendChild(this._productBadges.toElement()),this._element.appendChild(this._animationViewPort.toElement()),this._element.appendChild(this._zoomViewport.toElement()),this._element.appendChild(this._eventMask.toElement()),this._pcc=new P({trackedElementX:function(t,e){e=this._adjustValueRelativeToBody(e,"x"),this._element.style.left=e+"px"}.bind(this),trackedElementY:function(t,e){e=this._adjustValueRelativeToBody(e,"y"),this._element.style.top=e+"px"}.bind(this),trackedElementWidth:function(t,e){this._element.style.width=e+"px"}.bind(this),trackedElementHeight:function(t,e){this._element.style.height=e+"px"}.bind(this)})},_adjustValueRelativeToBody:function(t,e){if("static"===getComputedStyle(document.body).position)return t;var i=document.body.getBoundingClientRect();return"x"===e?t-(i.left+window.pageXOffset):t-(i.top+window.pageYOffset)},_onUpdate:function(t){this._pcc.check(t),this._panViewport.update(t),this._zoomGlass.update(t),this._productBadges.update(t),this._animationViewPort.update(t),this._zoomViewport.update(t)},toElement:function(){return this._element}}),H=new l({constructor:function(t,e,i,n,a,o){this.small=t,this.large=e,this.full=i,this.originalElement=a,this.isVideo=null!==n,this.videoData=n,this.isAnimated=o},static__create:function(t,e,i,n,a,o){var s,r,h,c=0,l=function(){g(i).then(t=>{o(new H(s,r,h,n,a,t))})};U.create(t,function(t){s=t,3===++c&&l()}),U.create(e,function(t){r=t,3===++c&&l()}),U.create(i,function(t){h=t,3===++c&&l()})}}),U=new l({constructor:function(t,e,i,n){this.src=t,this.width=e,this.height=i,this.img=n},static__create:function(e,i){var n,a;n=i,a=!1,i=function(){if(!a)return a=!0,n.apply(this,arguments)};var o=document.createElement("img");o.crossOrigin=!0,o.src=e,o.onload=function(){i(new U(e,o.naturalWidth||o.width,o.naturalHeight||o.height,o))},o.onerror=function(){i(null)},setTimeout(function(){i(null)},t)}}),F=new l({constructor:function(t,e){this._store=t,this._bullets=e.bullets,this._activeClass=e.bulletActiveClass,this._state=null,this._lastActive=null,this._store.subscribe(this._onUpdate.bind(this)),this._pcc=new P({panSlide:this._updateActive.bind(this),visibleElements:this._updateVisible.bind(this)})},_onUpdate:function(t){this._state=t,this._pcc.check(t)},_updateActive:function(){null!==this._lastActive&&this._bullets[this._lastActive].forEach(function(t){t.classList.remove(this._activeClass)});var t=this._state.visibleElements[this._state.panSlide];this._bullets[t].forEach(function(t){t.classList.remove(this._activeClass)}),this._lastActive=t},_updateVisible:function(){this._bullets.forEach(function(t){t.forEach(function(t){t.style.display="none"})}),this._state.visibleElements.forEach(function(t){this._bullets[t].forEach(function(t){t.style.display=""})},this)}}),W=new l({constructor:function(t){this._store=t,this._state=t.getState(),t.subscribe(this._onUpdate.bind(this)),this._pcc=new P({imageData:this._onImageDataChange.bind(this),elementSlideMap:this._onElementSlideMapChange.bind(this)}),this._slideIndex=0,this._map=this._state.elementSlideMap},_onUpdate:function(t){this._state=t,this._pcc.check(t)},_onElementSlideMapChange:function(){var t=this._state;t.elementSlideMap.forEach(function(e,i){if(0!==i&&t.imageData[i]&&t.imageData[e]){var n=t.imageData[i].originalElement,a=t.imageData[e],o=null==a.videoData?"":JSON.stringify(a.videoData),s=T(t.elements).indexOf(B(a.originalElement.id)),r=n.querySelector("img");n.setAttribute("data-video",o),n.setAttribute("data-pic-thumb-id",s),r.setAttribute("data-pic-thumb-id",s),r.src=a.small.src}})},_onImageDataChange:function(){this._state.elements.forEach(function(t){t.removeAttribute("data-pic-thumb-id"),t.querySelector("img").removeAttribute("data-pic-thumb-id")})}});function X(t){return[].slice.call(t)}function Y(t,e){var i=[],n=0,a=t.length;t.forEach(function(t,o){var s=t.getAttribute("data-thumbnailimg"),r=t.getAttribute("data-largeimg"),h=t.getAttribute("href"),c=JSON.parse(t.getAttribute("data-video")||null);"#"===h&&(h=null),r||(r=h),s||(s=r),null!==h?H.create(s,r,h,c,t,function(t){i[o]=t,++n===a&&(i=i.filter(function(t){return null!==t.full}),e(i))}):a--})}function G(t,e,i,n,a,o){var s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.img);var r=e.dw,h=e.dh,c=(a-h)/2,l=((n-r)/2+i)/t.canvas.width*2-1,d=c/t.canvas.height*-2+1,u=r/t.canvas.width*2,m=h/t.canvas.height*-2;t.uniformMatrix3fv(o,!1,[u,0,0,0,m,0,l,d,1]),t.drawArrays(t.TRIANGLES,0,6)}function V(){for(var{primary:t,fallback:e}of[{primary:"a:not(.js-ignore-carousel) #_EKM_PRODUCTIMAGE_1",fallback:"#_EKM_PRODUCTIMAGE_1"},{primary:'a:not(.js-ignore-carousel) [id^="_EKM_PRODUCTIMAGE_1_"]',fallback:'[id^="_EKM_PRODUCTIMAGE_1_"]'}]){var i=document.querySelector(t);if(null===i){var n=document.querySelector(e);if(null===n)continue;return n.parentNode.parentNode}for(;i.parentNode;){if("A"===i.tagName)return i.parentNode;i=i.parentNode}}return null}function Z(t){var e=new Map;return t.forEach(function(t,i){e.set(i,t)}),e}function B(t){var e=/_(\d+)(?:_\d+)?/.exec(t);return parseInt(e[1],10)}return I=function(t){if(void 0!==S)throw new Error("API store already set.");S=t},x={resetThumbnailOrder:function(){S&&S.dispatch({type:"RESET_THUMBNAIL_ORDER"})}},window.addEventListener("DOMContentLoaded",function(){var t=X(document.querySelectorAll('[id^="_EKM_PRODUCTIMAGE_LINK_"]:not(.js-ignore-carousel)'));t.sort(function(t,e){return B(t.id)-B(e.id)});var e={elements:t,lightbox:!!(window.ekm&&ekm.$&&ekm.$.fn.lightBox),zoom:!(!window.ekm||!ekm.mousezoomOptions),zoomOptions:window.ekm&&ekm.mousezoomOptions||{},bullets:[],bulletActiveClass:"ekm-pic-active",leftNavigation:null,rightNavigation:null};window.mouse_zoom_mobile_check&&(e.zoomOptions.glass=!1,e.zoomOptions.offsetX=0,e.zoomOptions.offsetY=0,e.zoomOptions.position="center"),!1===window.mouse_zoom_mobile_check&&e.zoom&&(e.zoomOptions.hoverTrigger=!0),window.ekm&&window.ekm.productImageCarouselSettings&&(e=function(t){for(var e=X(arguments),i=1,n=e.length;i<n;i++){var a=e[i];for(var o in a)a.hasOwnProperty(o)&&(t[o]=a[o])}return t}(e,window.ekm.productImageCarouselSettings)),e.bullets=e.bullets.map(function(t){return X(document.querySelectorAll(t))}),e.leftNavigation&&(e.leftNavigation=X(document.querySelectorAll(e.leftNavigation))),e.rightNavigation&&(e.rightNavigation=X(document.querySelectorAll(e.rightNavigation))),y(e,function(i){I(i);var n=V();if(null!==n){new k(i,n);var a=new N(i);document.body.appendChild(a.toElement());var o=T(t);X(document.querySelectorAll('[id^="_EKM_PRODUCTIMAGE_"]')).forEach(function(t){window.ekm&&ekm.$&&ekm.$.fn.lightBox&&ekm.$(t).unbind(),t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var n=parseInt(t.getAttribute("data-pic-thumb-id")||o.indexOf(B(t.id)),10);i.dispatch({type:"GOTO_SLIDE",slide:n,swapThumbs:!0})})}),new W(i);var s=d(function(){i.dispatch({type:"UPDATE_IMAGE_DATA"})},null,17),r=function(t){t.forEach(function(t){var e=t.attributeName;"href"!==e&&"data-thumbnailimg"!==e&&"data-largeimg"!==e||s()})};t.forEach(function(t){new MutationObserver(r).observe(t,{attributes:!0,childList:!1,subtree:!1})}),e.leftNavigation&&e.leftNavigation.forEach(function(t){t.addEventListener("click",function(t){i.dispatch({type:"PAN_LEFT"})})}),e.rightNavigation&&e.rightNavigation.forEach(function(t){t.addEventListener("click",function(t){i.dispatch({type:"PAN_RIGHT"})})}),e.bullets.forEach(function(t,e){t.forEach(function(t){t.addEventListener("click",function(t){i.dispatch({type:"GOTO_SLIDE",slide:e})})})}),e.bullets.length&&new F(i,e),i.dispatch({type:"APP_START"})}})}),x}();